<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>File Renamer</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; }
    h2 { margin-bottom: 8px; }
    .desc { color:#555; font-size:14px; margin-bottom:16px; line-height:1.45; }
    .panel {
      border: 1px solid #e5e5e5;
      border-radius: 12px;
      padding: 14px;
      margin: 14px 0 16px;
      background: #fafafa;
    }
    .panel h3 { margin: 0 0 10px; font-size: 14px; }
    .options { display: grid; gap: 8px; }
    label { display:flex; gap:10px; align-items:flex-start; cursor:pointer; }
    .opt-title { font-weight: 600; }
    .opt-sub { color:#666; font-size: 12px; margin-top:2px; }
    .drop { border: 2px dashed #999; border-radius: 12px; padding: 32px; text-align: center; cursor: pointer; }
    .drop.drag { border-color: #111; background: #f5f5f5; }
    button { margin-top: 16px; padding: 10px 14px; border: none; border-radius: 10px; background: #111; color: #fff; cursor: pointer; }
    button:disabled { opacity: .5; cursor: not-allowed; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
    th, td { border-bottom: 1px solid #e5e5e5; padding: 10px; text-align: left; }
    code { background: #f2f2f2; padding: 2px 6px; border-radius: 6px; }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .pill { font-size:12px; color:#444; background:#f2f2f2; border-radius:999px; padding:4px 10px; }
  </style>
</head>
<body>

<h2>File Name Auto Renamer</h2>
<div class="desc">
  Rules: lowercase only / spaces → hyphen / underscores → hyphen / remove special characters /
  collapse multiple hyphens / trim leading & trailing hyphens / handle duplicates with -2, -3
</div>

<div class="panel">
  <h3>Preset</h3>
  <div class="options" id="presetOptions">
    <label>
      <input type="radio" name="preset" value="" checked>
      <div>
        <div class="opt-title">Default</div>
        <div class="opt-sub">No suffix</div>
      </div>
    </label>

    <label>
      <input type="radio" name="preset" value="-1220x732">
      <div>
        <div class="opt-title">Reference images</div>
        <div class="opt-sub">Adds <code>-1220x732</code> before the extension</div>
      </div>
    </label>

    <label>
      <input type="radio" name="preset" value="-1440x450">
      <div>
        <div class="opt-title">Banner images</div>
        <div class="opt-sub">Adds <code>-1440x450</code> before the extension</div>
      </div>
    </label>

    <label>
      <input type="radio" name="preset" value="-headshot">
      <div>
        <div class="opt-title">Bio images</div>
        <div class="opt-sub">Adds <code>-headshot</code> before the extension</div>
      </div>
    </label>
  </div>

  <div class="row" style="margin-top:10px;">
    <span class="pill" id="activePresetPill">Active: Default</span>
  </div>
</div>

<div id="drop" class="drop">
  Drag & drop files here<br/>
  (or click to select files)
</div>

<button id="download" disabled>Download ZIP</button>

<table id="table" style="display:none">
  <thead>
    <tr>
      <th>Original file name</th>
      <th>Renamed file name</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script>
  const drop = document.getElementById('drop');
  const table = document.getElementById('table');
  const tbody = table.querySelector('tbody');
  const downloadBtn = document.getElementById('download');
  const activePresetPill = document.getElementById('activePresetPill');

  let files = [];

  function getPresetSuffix() {
    const checked = document.querySelector('input[name="preset"]:checked');
    return checked ? checked.value : '';
  }

  function getPresetLabel() {
    const checked = document.querySelector('input[name="preset"]:checked');
    if (!checked) return 'Default';
    const map = {
      '': 'Default',
      '-1220x732': 'Reference images',
      '-1440x450': 'Banner images',
      '-headshot': 'Bio images'
    };
    return map[checked.value] ?? 'Custom';
  }

  function refreshPresetPill() {
    activePresetPill.textContent = `Active: ${getPresetLabel()}`;
  }

  function resetUI() {
    tbody.innerHTML = '';
    table.style.display = 'none';
    downloadBtn.disabled = true;
  }

  function sanitizeBaseName(base) {
    // lowercase
    let name = base.toLowerCase();

    // underscores -> hyphen
    name = name.replace(/_+/g, '-');

    // whitespace -> hyphen
    name = name.replace(/\s+/g, '-');

    // keep only a–z, 0–9, and hyphens
    name = name.replace(/[^a-z0-9-]/g, '');

    // collapse multiple hyphens (--- -> -)
    name = name.replace(/-+/g, '-');

    // trim leading/trailing hyphens
    name = name.replace(/^-+|-+$/g, '');

    // fallback
    if (!name) name = 'file';

    return name;
  }

  function splitNameExt(originalName) {
    const dot = originalName.lastIndexOf('.');
    const hasExt = dot > 0;
    const ext = hasExt ? originalName.slice(dot).toLowerCase() : '';
    const base = hasExt ? originalName.slice(0, dot) : originalName;
    return { base, ext };
  }

  function renameFile(originalName, usedNames) {
    const { base, ext } = splitNameExt(originalName);

    const suffix = getPresetSuffix();
    const cleanBase = sanitizeBaseName(base);

    // add suffix before extension
    let stem = cleanBase + suffix;

    // if suffix causes trailing hyphen issues (unlikely), normalize just in case
    stem = stem.replace(/-+/g, '-').replace(/^-+|-+$/g, '');
    if (!stem) stem = 'file';

    // handle duplicates with -2, -3...
    let finalName = stem + ext;
    let count = 2;
    while (usedNames.has(finalName)) {
      finalName = `${stem}-${count}${ext}`;
      count++;
    }
    usedNames.add(finalName);
    return finalName;
  }

  function render() {
    tbody.innerHTML = '';

    if (files.length === 0) {
      resetUI();
      return;
    }

    table.style.display = '';
    downloadBtn.disabled = false;

    for (const f of files) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><code>${f.original}</code></td>
        <td><code>${f.renamed}</code></td>
      `;
      tbody.appendChild(tr);
    }
  }

  function startNewBatch() {
    files = [];
    resetUI();
  }

  function handleFiles(fileList, isNewBatch = false) {
    const list = Array.from(fileList || []);
    if (list.length === 0) return;

    if (isNewBatch) startNewBatch();

    // dedupe within this batch only
    const usedNames = new Set();

    const next = [];
    for (const file of list) {
      const renamed = renameFile(file.name, usedNames);
      next.push({ file, original: file.name, renamed });
    }
    files = next;
    render();
  }

  // preset UI
  document.getElementById('presetOptions').addEventListener('change', () => {
    refreshPresetPill();

    // Optional UX: if there is an existing list, re-run rename for current files with new preset
    // (does NOT re-read file blobs; only recalculates names)
    if (files.length > 0) {
      const usedNames = new Set();
      files = files.map(f => ({
        file: f.file,
        original: f.original,
        renamed: renameFile(f.original, usedNames)
      }));
      render();
    }
  });
  refreshPresetPill();

  // drag & drop
  drop.addEventListener('dragover', e => {
    e.preventDefault();
    drop.classList.add('drag');
  });
  drop.addEventListener('dragleave', () => drop.classList.remove('drag'));
  drop.addEventListener('drop', e => {
    e.preventDefault();
    drop.classList.remove('drag');
    handleFiles(e.dataTransfer.files, true); // new drop = new batch
  });

  // click to pick files
  drop.addEventListener('click', () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.multiple = true;
    input.onchange = () => {
      handleFiles(input.files, true); // new selection = new batch
      input.value = '';
    };
    input.click();
  });

  // download zip
  downloadBtn.addEventListener('click', async () => {
    if (files.length === 0) return;

    const zip = new JSZip();
    for (const f of files) {
      const buf = await f.file.arrayBuffer();
      zip.file(f.renamed, buf);
    }
    const blob = await zip.generateAsync({ type: 'blob' });

    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'renamed-files.zip';
    a.click();
    URL.revokeObjectURL(a.href);
  });

  resetUI();
</script>

</body>
</html>
